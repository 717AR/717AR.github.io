<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FAR Part 117 FDP Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
    }
    label {
      margin-top: 12px;
      display: block;
      font-weight: bold;
    }
    input, select {
      padding: 6px;
      margin: 6px 0;
      width: 100%;
      max-width: 320px;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #2e7d32;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
    button:hover {
      background-color: #1b5e20;
    }
    .result {
      margin-top: 25px;
      padding: 15px;
      border: 1px solid #ccc;
      background: #f9f9f9;
    }
    .warning {
      color: #b71c1c;
      font-weight: bold;
    }
    .note {
      font-size: 0.9rem;
      color: #555;
    }
  </style>
</head>
<body>

<h1>FAR Part 117 Flight Duty Period (FDP) Calculator</h1>
<p class="note">This calculator models FAA FAR 117 Tables A & B. It is for planning and educational use only.</p>

<form id="fdpForm">
  <label for="reportTime">Report Time (Local, HH:mm)</label>
  <input type="time" id="reportTime" required />

  <label for="segments">Number of Flight Segments</label>
  <select id="segments">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8">8</option>
  </select>

  <label for="pilots">Number of Pilots</label>
  <select id="pilots">
    <option value="2">2 (Unaugmented)</option>
    <option value="3">3 (Augmented)</option>
    <option value="4">4 (Augmented)</option>
  </select>

  <label for="restFacility">Crew Rest Facility (Augmented Only)</label>
  <select id="restFacility">
    <option value="1">Class 1</option>
    <option value="2">Class 2</option>
    <option value="3">Class 3</option>
  </select>

  <button type="submit">Calculate FDP</button>
</form>

<div class="result" id="result"></div>

<script>
  // FAR 117 FDP limits — TABLE B (§117.13 / §117.17)
  // Single authoritative table for FDP
  // Unaugmented (2 pilots) values are embedded per Table B
  const tableB_FDP = {
    unaugmented: {
      day:   [9, 9, 9, 9, 8.5, 8, 7.5, 7.5],
      night:[8, 8, 8, 8, 8,   8, 7.5, 7.5]
    },
    3: { // 3 pilots (augmented)
      1: { day: 13, night: 12 },
      2: { day: 12, night: 11 },
      3: { day: 11, night: 10 }
    },
    4: { // 4 pilots (augmented)
      1: { day: 17, night: 16 },
      2: { day: 16, night: 15 },
      3: { day: 15, night: 14 }
    }
  };

  // FAR 117 Table B (Augmented)
  const tableB = {
    3: { // 3 pilots
      1: { day: 13, night: 12 },
      2: { day: 12, night: 11 },
      3: { day: 11, night: 10 }
    },
    4: { // 4 pilots
      1: { day: 17, night: 16 },
      2: { day: 16, night: 15 },
      3: { day: 15, night: 14 }
    }
  };

  function getTimeWindow(timeStr) {
    const [h, m] = timeStr.split(':').map(Number);
    const minutes = h * 60 + m;

    // Day window: 0500–1959
    if (minutes >= 300 && minutes <= 1199) return 'day';
    return 'night';
  }

  document.getElementById('fdpForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const reportTime = document.getElementById('reportTime').value;
    const segments = parseInt(document.getElementById('segments').value, 10);
    const pilots = parseInt(document.getElementById('pilots').value, 10);
    const rest = parseInt(document.getElementById('restFacility').value, 10);

    const window = getTimeWindow(reportTime);

    let maxFDP;
    let notes = [];

    if (pilots === 2) {
      // FDP per Table B – Unaugmented (§117.13)
      maxFDP = tableB_FDP.unaugmented[window][Math.min(segments - 1, 7)];
      notes.push('FDP calculated per Table B (§117.13), unaugmented.');
    } else {
      // FDP per Table B – Augmented (§117.17)
      maxFDP = tableB_FDP[pilots][rest][window];
      notes.push('FDP calculated per Table B (§117.17), augmented.');
    }
      
      // Augmented – Table B
      maxFDP = tableB[pilots][rest][window];
      notes.push('Augmented operation assumed per §117.17.');
    }

    const woclWarning = window === 'night'
      ? '<p class="warning">⚠ FDP occurs during the WOCL (0200–0559). This reduces allowable FDP per FAR 117.</p>'
      : '';

    document.getElementById('result').innerHTML = `
      <h3>FDP Calculation Result</h3>
      <p><strong>Report Time:</strong> ${reportTime}</p>
      <p><strong>Time Window:</strong> ${window === 'day' ? '0500–1959' : '2000–0459'}</p>
      <p><strong>Segments:</strong> ${segments}</p>
      <p><strong>Pilots:</strong> ${pilots}</p>
      <p><strong>Maximum Allowable FDP:</strong> ${maxFDP} hours</p>
      ${woclWarning}
      ${notes.map(n => `<p class="note">${n}</p>`).join('')}
    `;
  });
</script>

</body>
</html>
