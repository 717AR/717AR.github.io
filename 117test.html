<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Max FDP Calculator</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#0e1a2b;
  color:#f5f5f5;
  padding:16px;
}
h1 {
  text-align:center;
  margin-bottom:16px;
}
.card {
  background:#11243b;
  padding:16px;
  max-width:480px;
  margin:auto;
  border-radius:10px;
}
label {
  display:block;
  margin-top:10px;
  font-weight:bold;
}
input, select {
  width:100%;
  padding:8px;
  margin-top:4px;
  border-radius:6px;
  border:1px solid #4a90e2;
  background:#1a2a44;
  color:#f5f5f5;
}
button {
  margin-top:14px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:6px;
  background:#1fa2ff;
  color:white;
  font-size:16px;
  cursor:pointer;
}
button:hover {
  background:#0d8ae6;
}
.result {
  margin-top:16px;
  padding:12px;
  background:rgba(255,255,255,0.05);
  border-radius:8px;
}
.hidden {
  display:none;
}
</style>
</head>

<body>

<h1>Max FDP Calculator</h1>

<div class="card">
<form id="fdpForm">

  <label for="reportTime">Report Time</label>
  <input type="time" id="reportTime" required>

  <label for="segments">Flight Segments</label>
  <select id="segments">
    <option value="1">1</option><option value="2">2</option><option value="3">3</option>
    <option value="4">4</option><option value="5">5</option>
    <option value="6">6</option><option value="7">7</option>
  </select>

  <label for="pilots">Number of Pilots</label>
  <select id="pilots">
    <option value="2">2 (Unaugmented)</option>
    <option value="3">3 (Augmented)</option>
    <option value="4">4 (Augmented)</option>
  </select>

  <div id="restWrapper" class="hidden">
    <label for="restClass">Crew Rest Facility Class</label>
    <select id="restClass">
      <option value="1">Class 1</option>
      <option value="2">Class 2</option>
      <option value="3">Class 3</option>
    </select>
  </div>

  <button type="submit">Calculate</button>
</form>

<div id="result" class="result"></div>
</div>

<script>
// ---------- Helpers ----------
function timeToMinutes(t){
  const [h,m] = t.split(':').map(Number);
  return h * 60 + m;
}

// ---------- TABLE B (2 pilots, unaugmented) ----------
const tableB = [
  {start:0, end:239, vals:[9,9,9,9,9,9,9]},
  {start:240, end:299, vals:[10,10,10,10,9,9,9]},
  {start:300, end:359, vals:[12,12,12,12,11.5,11,10.5]},
  {start:360, end:419, vals:[13,13,12,12,11.5,11,10.5]},
  {start:420, end:719, vals:[14,14,13,13,12.5,12,11.5]},
  {start:720, end:779, vals:[13,13,13,13,12.5,12,11.5]},
  {start:780, end:1019, vals:[12,12,12,12,11.5,11,10.5]},
  {start:1020, end:1319, vals:[12,12,11,11,10,9,9]},
  {start:1320, end:1379, vals:[11,11,10,10,9,9,9]},
  {start:1380, end:1439, vals:[10,10,10,9,9,9,9]}
];

// ---------- TABLE C (3/4 pilots, EXACT per user) ----------
const tableC = [
  { start:0, end:359,
    c1:{3:15,4:17}, c2:{3:14,4:15.5}, c3:{3:13,4:13.5} },
  { start:360, end:419,
    c1:{3:16,4:18.5}, c2:{3:15,4:16.5}, c3:{3:14,4:14.5} },
  { start:420, end:779,
    c1:{3:17,4:19}, c2:{3:16.5,4:18}, c3:{3:15,4:15.5} },
  { start:780, end:1019,
    c1:{3:16,4:18.5}, c2:{3:15,4:16.5}, c3:{3:14,4:14.5} },
  { start:1020, end:1439,
    c1:{3:15,4:17}, c2:{3:14,4:15.5}, c3:{3:13,4:13.5} }
];

// ---------- Lookups ----------
function lookupTableB(mins, segs){
  const row = tableB.find(r => mins >= r.start && mins <= r.end);
  return row ? row.vals[Math.min(segs-1, row.vals.length-1)] : 0;
}

function lookupTableC(mins, restClass, pilots){
  const row = tableC.find(r => mins >= r.start && mins <= r.end);
  if(!row) return 0;
  return row['c'+restClass][pilots];
}

// ---------- UI Logic ----------
const pilotsSelect = document.getElementById('pilots');
const restWrapper = document.getElementById('restWrapper');

pilotsSelect.addEventListener('change', () => {
  restWrapper.classList.toggle('hidden', pilotsSelect.value === '2');
});

// ---------- Calculate ----------
document.getElementById('fdpForm').addEventListener('submit', e => {
  e.preventDefault();

  const mins = timeToMinutes(reportTime.value);
  const pilots = Number(pilotsSelect.value);
  const segs = Number(document.getElementById('segments').value);

  let maxFDP = 0;
  let source = '';

  if (pilots === 2) {
    maxFDP = lookupTableB(mins, segs);
    source = 'Table B';
  } else {
    const restClass = Number(document.getElementById('restClass').value);
    maxFDP = lookupTableC(mins, restClass, pilots);
    source = 'Table C';
  }

  document.getElementById('result').innerHTML = `
    <p><strong>Max FDP:</strong> ${maxFDP} hours</p>
    <p><strong>Applied Table:</strong> ${source}</p>
  `;
});
</script>

</body>
</html>
