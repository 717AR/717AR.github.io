<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>117 Max FDP Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#0e1a2b;
  color:#f5f5f5;
  padding:16px;
}
h1 {
  text-align:center;
  margin-bottom:14px;
}
.card {
  background:#11243b;
  padding:16px;
  max-width:480px;
  margin:auto;
  border-radius:10px;
}
label {
  display:block;
  margin-top:10px;
  font-weight:bold;
}
input, select {
  width:100%;
  padding:8px;
  margin-top:4px;
  border-radius:6px;
  border:1px solid #4a90e2;
  background:#1a2a44;
  color:#ffffff;
}
button {
  margin-top:16px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:6px;
  background:#1fa2ff;
  color:white;
  font-size:16px;
  cursor:pointer;
}
button:hover {
  background:#0d8ae6;
}

/* Toggle */
.toggle {
  position:relative;
  height:44px;
  margin-bottom:14px;
}
.toggle input {
  display:none;
}
.toggle-label {
  display:block;
  height:100%;
  background:#1a2a44;
  border-radius:24px;
  position:relative;
  cursor:pointer;
}
.toggle-label span {
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:50%;
  text-align:center;
  font-weight:bold;
}
.toggle-label .left { left:0; }
.toggle-label .right { right:0; opacity:0.6; }
.toggle-knob {
  position:absolute;
  top:2px;
  left:2px;
  width:calc(50% - 4px);
  height:calc(100% - 4px);
  background:#1fa2ff;
  border-radius:24px;
  transition:left 0.25s;
}
input:checked + .toggle-label .toggle-knob {
  left:50%;
}
input:checked + .toggle-label .left {
  opacity:0.6;
}
input:checked + .toggle-label .right {
  opacity:1;
}

/* Results */
.result {
  margin-top:18px;
  padding:14px;
  background:rgba(255,255,255,0.06);
  border-radius:10px;
}
.result-main {
  font-size:22px;
  font-weight:bold;
}
.result-sub {
  font-size:14px;
  margin-top:6px;
  opacity:0.9;
}
.highlight {
  margin-top:10px;
  padding:10px;
  border-left:4px solid #1fa2ff;
  background:rgba(31,162,255,0.15);
}

.hidden { display:none; }
</style>
</head>

<body>

<h1>Max FDP Calculator</h1>

<div class="card">
<form id="fdpForm">

  <!-- Mode Toggle -->
  <div class="toggle">
    <input type="checkbox" id="modeToggle">
    <label class="toggle-label" for="modeToggle">
      <span class="left">Bid / LCR</span>
      <span class="right">SCR</span>
      <div class="toggle-knob"></div>
    </label>
  </div>

  <!-- RAP / Report -->
  <label id="rapLabel">Report Time</label>
  <input type="time" id="rapTime" required>

  <!-- FDP start (SCR only) -->
  <div id="fdpStartWrapper" class="hidden">
    <label>Report Time (FDP)</label>
    <input type="time" id="fdpStart">
  </div>

  <!-- Segments -->
  <label>Flight Segments</label>
  <select id="segments">
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
  </select>

  <!-- Pilots -->
  <label>Number of Pilots</label>
  <select id="pilots">
    <option value="2">2 (Unaugmented)</option>
    <option value="3">3 (Augmented)</option>
    <option value="4">4 (Augmented)</option>
  </select>

  <button type="submit">Calculate</button>
</form>

<div id="result" class="result hidden"></div>
</div>

<script>
// ---------- DOM ----------
const form = document.getElementById('fdpForm');
const modeToggle = document.getElementById('modeToggle');
const rapLabel = document.getElementById('rapLabel');
const rapTime = document.getElementById('rapTime');
const fdpStartWrapper = document.getElementById('fdpStartWrapper');
const fdpStart = document.getElementById('fdpStart');
const segments = document.getElementById('segments');
const pilots = document.getElementById('pilots');
const result = document.getElementById('result');

// ---------- Helpers ----------
function toMinutes(t){
  const [h,m] = t.split(':').map(Number);
  return h*60 + m;
}
function toHHMM(m){
  const h = Math.floor(m/60)%24;
  const mm = m%60;
  return `${String(h).padStart(2,'0')}:${String(mm).padStart(2,'0')}`;
}

// ---------- Table B ----------
const tableB = [
  {s:0,e:239,v:[9,9,9,9,9,9,9]},
  {s:240,e:299,v:[10,10,10,10,9,9,9]},
  {s:300,e:359,v:[12,12,12,12,11.5,11,10.5]},
  {s:360,e:419,v:[13,13,12,12,11.5,11,10.5]},
  {s:420,e:719,v:[14,14,13,13,12.5,12,11.5]},
  {s:720,e:779,v:[13,13,13,13,12.5,12,11.5]},
  {s:780,e:1019,v:[12,12,12,12,11.5,11,10.5]},
  {s:1020,e:1319,v:[12,12,11,11,10,9,9]},
  {s:1320,e:1379,v:[11,11,10,10,9,9,9]},
  {s:1380,e:1439,v:[10,10,10,9,9,9,9]}
];
function lookupTableB(mins,segs){
  return tableB.find(r=>mins>=r.s && mins<=r.e).v[segs-1];
}

// ---------- UI ----------
modeToggle.addEventListener('change', ()=>{
  const isSCR = modeToggle.checked;
  rapLabel.textContent = isSCR ? 'RAP Start Time' : 'Report Time';
  fdpStartWrapper.classList.toggle('hidden', !isSCR);
});

// ---------- Calculate ----------
form.addEventListener('submit', e=>{
  e.preventDefault();

  const isSCR = modeToggle.checked;
  const pilotCount = Number(pilots.value);

  // SCR + Unaugmented
  if(isSCR && pilotCount === 2){
    if(!fdpStart.value){
      alert('Please enter Report Time (FDP)');
      return;
    }

    const rap = toMinutes(rapTime.value);
    const fdp = toMinutes(fdpStart.value);
    const tb = lookupTableB(fdp, Number(segments.value));

    const limits = [
      {label:'RAP + 16:00', end: rap + 16*60},
      {label:`FDP + Table B (${tb} hrs)`, end: fdp + tb*60},
      {label:`RAP + Table B (${tb}) + 4:00`, end: rap + tb*60 + 4*60}
    ];

    limits.sort((a,b)=>a.end - b.end);
    const controlling = limits[0];
    const duration = ((controlling.end - fdp)/60).toFixed(1);

    result.innerHTML = `
      <div class="result-main">Max FDP Ends: ${toHHMM(controlling.end)}</div>
      <div class="result-sub">Total FDP Duration: ${duration} hrs</div>

      <div class="highlight">
        <strong>Controlling Limit:</strong><br>
        ${controlling.label}
      </div>

      <div class="result-sub">
        Other Limits:<br>
        ${limits.slice(1).map(l=>`${l.label} â†’ ${toHHMM(l.end)}`).join('<br>')}
      </div>
    `;
  } else {
    result.innerHTML = `
      <div class="result-main">SCR logic applies to 2-pilot crews only</div>
      <div class="result-sub">
        Bid / LCR calculations remain unchanged.
      </div>
    `;
  }

  result.classList.remove('hidden');
});
</script>

</body>
</html>
