<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>117 Calculator</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#0e1a2b;
  color:#f5f5f5;
  padding:16px;
}
h1 { text-align:center; margin-bottom:14px; }
.card {
  background:#11243b;
  padding:16px;
  max-width:480px;
  margin:auto;
  border-radius:10px;
}
label {
  display:block;
  margin-top:10px;
  font-weight:bold;
}
input, select {
  width:100%;
  padding:8px;
  margin-top:4px;
  border-radius:6px;
  border:1px solid #4a90e2;
  background:#1a2a44;
  color:#ffffff;
}
button {
  margin-top:16px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:6px;
  background:#1fa2ff;
  color:white;
  font-size:16px;
  cursor:pointer;
}
button:hover { background:#0d8ae6; }

/* Toggle */
.toggle {
  position:relative;
  height:44px;
  margin-bottom:14px;
}
.toggle input { display:none; }
.toggle-label {
  display:block;
  height:100%;
  background:#1a2a44;
  border-radius:24px;
  position:relative;
  cursor:pointer;
}
.toggle-label span {
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:50%;
  text-align:center;
  font-weight:bold;
}
.toggle-label .left { left:0; }
.toggle-label .right { right:0; opacity:0.6; }
.toggle-knob {
  position:absolute;
  top:2px;
  left:2px;
  width:calc(50% - 4px);
  height:calc(100% - 4px);
  background:#1fa2ff;
  border-radius:24px;
  transition:left 0.25s;
}
input:checked + .toggle-label .toggle-knob { left:50%; }
input:checked + .toggle-label .left { opacity:0.6; }
input:checked + .toggle-label .right { opacity:1; }

.result {
  margin-top:18px;
  padding:14px;
  background:rgba(255,255,255,0.06);
  border-radius:10px;
}
.result-main { font-size:22px; font-weight:bold; }
.result-sub { font-size:14px; margin-top:6px; opacity:0.9; }

.hidden { display:none; }
</style>
</head>

<body>
<h1>Max FDP Calculator</h1>

<div class="card">
<form id="fdpForm">

  <!-- Bid/LCR vs SCR -->
  <div class="toggle">
    <input type="checkbox" id="reserveToggle">
    <label class="toggle-label" for="reserveToggle">
      <span class="left">Bid / LCR</span>
      <span class="right">SCR</span>
      <div class="toggle-knob"></div>
    </label>
  </div>

  <label id="timeLabel" for="reportTime">Report Time</label>
  <input type="time" id="reportTime" required>

  <!-- SCR FDP report -->
  <div id="fdpStartWrapper" class="hidden">
    <label for="fdpStart">Report Time (FDP)</label>
    <input type="time" id="fdpStart">
  </div>

  <div id="segmentsWrapper">
    <label for="segments">Flight Segments</label>
    <select id="segments">
      <option value="1">1</option><option value="2">2</option>
      <option value="3">3</option><option value="4">4</option>
      <option value="5">5</option><option value="6">6</option>
      <option value="7">7</option>
    </select>
  </div>

  <label for="pilots">Number of Pilots</label>
  <select id="pilots">
    <option value="2">2 (Unaugmented)</option>
    <option value="3">3 (Augmented)</option>
    <option value="4">4 (Augmented)</option>
  </select>

  <div id="restWrapper" class="hidden">
    <label for="restClass">Crew Rest Facility Class</label>
    <select id="restClass">
      <option value="1">Class 1</option>
      <option value="2">Class 2</option>
      <option value="3">Class 3</option>
    </select>
  </div>

  <button type="submit">Calculate</button>
</form>

<div id="result" class="result hidden"></div>
</div>

<script>
// Helpers
function timeToMinutes(t){
  const [h,m] = t.split(':').map(Number);
  return h*60 + m;
}
function minutesToHHMM(m){
  const h = Math.floor(m/60)%24;
  const mm = m%60;
  return `${String(h).padStart(2,'0')}:${String(mm).padStart(2,'0')}`;
}

// Table B
const tableB = [
  {start:0,end:239,vals:[9,9,9,9,9,9,9]},
  {start:240,end:299,vals:[10,10,10,10,9,9,9]},
  {start:300,end:359,vals:[12,12,12,12,11.5,11,10.5]},
  {start:360,end:419,vals:[13,13,12,12,11.5,11,10.5]},
  {start:420,end:719,vals:[14,14,13,13,12.5,12,11.5]},
  {start:720,end:779,vals:[13,13,13,13,12.5,12,11.5]},
  {start:780,end:1019,vals:[12,12,12,12,11.5,11,10.5]},
  {start:1020,end:1319,vals:[12,12,11,11,10,9,9]},
  {start:1320,end:1379,vals:[11,11,10,10,9,9,9]},
  {start:1380,end:1439,vals:[10,10,10,9,9,9,9]}
];

// Table C unchanged
const tableC = [
  {start:0,end:359, c1:{3:15,4:17}, c2:{3:14,4:15.5}, c3:{3:13,4:13.5}},
  {start:360,end:419, c1:{3:16,4:18.5}, c2:{3:15,4:16.5}, c3:{3:14,4:14.5}},
  {start:420,end:779, c1:{3:17,4:19}, c2:{3:16.5,4:18}, c3:{3:15,4:15.5}},
  {start:780,end:1019, c1:{3:16,4:18.5}, c2:{3:15,4:16.5}, c3:{3:14,4:14.5}},
  {start:1020,end:1439, c1:{3:15,4:17}, c2:{3:14,4:15.5}, c3:{3:13,4:13.5}}
];

function lookupTableB(mins,segs){
  const r = tableB.find(x=>mins>=x.start && mins<=x.end);
  return r ? r.vals[segs-1] : 0;
}
function lookupTableC(mins,rest,pilots){
  const r = tableC.find(x=>mins>=x.start && mins<=x.end);
  return r ? r['c'+rest][pilots] : 0;
}

// UI logic
const pilotsSel = document.getElementById('pilots');
const restWrap = document.getElementById('restWrapper');
const segWrap = document.getElementById('segmentsWrapper');
const reserveToggle = document.getElementById('reserveToggle');
const timeLabel = document.getElementById('timeLabel');
const fdpWrap = document.getElementById('fdpStartWrapper');

function updateVisibility(){
  const aug = pilotsSel.value !== '2';
  restWrap.classList.toggle('hidden', !aug);
  segWrap.classList.toggle('hidden', aug);
}
pilotsSel.addEventListener('change', updateVisibility);
updateVisibility();

reserveToggle.addEventListener('change', ()=>{
  const scr = reserveToggle.checked;
  timeLabel.textContent = scr ? 'RAP Start Time' : 'Report Time';
  fdpWrap.classList.toggle('hidden', !scr);
});

// Calculate
document.getElementById('fdpForm').addEventListener('submit', e=>{
  e.preventDefault();

  const rapMins = timeToMinutes(reportTime.value);
  const pilots = Number(pilotsSel.value);
  const segs = Number(segments.value);
  const rest = Number(restClass.value);
  const isSCR = reserveToggle.checked;

  let html = '';

  if(isSCR && pilots === 2){
    const fdpStart = timeToMinutes(fdpStart.value);
    const tb = lookupTableB(fdpStart, segs);

    const opt1 = rapMins + 16*60;
    const opt2 = fdpStart + tb*60;
    const opt3 = rapMins + tb*60 + 4*60;

    const limit = Math.min(opt1,opt2,opt3);

    html = `
      <div class="result-main">
        Max FDP Ends: ${minutesToHHMM(limit)}
      </div>
      <div class="result-sub">
        RAP + 16: ${minutesToHHMM(opt1)}<br>
        FDP + Table B (${tb}): ${minutesToHHMM(opt2)}<br>
        RAP + Table B (${tb}) + 4: ${minutesToHHMM(opt3)}
      </div>
    `;
  } else {
    const mins = timeToMinutes(reportTime.value);
    const max = pilots === 2
      ? lookupTableB(mins,segs)
      : lookupTableC(mins,rest,pilots);

    html = `
      <div class="result-main">Max FDP: ${max} hours</div>
      <div class="result-sub">${pilots===2?'Table B':'Table C'} applied</div>
    `;
  }

  const result = document.getElementById('result');
  result.classList.remove('hidden');
  result.innerHTML = html;
});
</script>

</body>
</html>
