<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Max FDP Calculator</title>
<style>
body{font-family:Arial,sans-serif;background:#0e1a2b;color:#f5f5f5;padding:16px}
h1{text-align:center;margin-bottom:14px}
.card{background:#11243b;padding:16px;max-width:480px;margin:auto;border-radius:10px}
label{display:block;margin-top:10px;font-weight:bold}
input,select{width:100%;padding:8px;margin-top:4px;border-radius:6px;border:1px solid #4a90e2;background:#1a2a44;color:#fff}
button{margin-top:16px;width:100%;padding:10px;border:none;border-radius:6px;background:#1fa2ff;color:#fff;font-size:16px;cursor:pointer}

/* ===== TOGGLE ===== */
.toggle{position:relative;height:44px;margin-bottom:14px}
.toggle input{display:none}
.toggle-label{display:block;height:100%;background:#1a2a44;border-radius:24px;position:relative;cursor:pointer}
.toggle-label span{position:absolute;top:50%;transform:translateY(-50%);width:50%;text-align:center;font-weight:bold;letter-spacing:0.5px;padding:0 8px;z-index:2;color:#ffffff;opacity:0.35;transition:opacity .25s}
.toggle-label .left{left:0;opacity:1}
.toggle-label .right{right:0}
.toggle-knob{position:absolute;top:2px;left:2px;width:calc(50% - 4px);height:calc(100% - 4px);background:#1fa2ff;border-radius:24px;transition:left .25s}
input:checked + .toggle-label .toggle-knob{left:50%}
input:checked + .toggle-label .left{opacity:0.35}
input:checked + .toggle-label .right{opacity:1}

/* ===== RESULTS ===== */
.result{margin-top:18px;padding:14px;background:rgba(255,255,255,.06);border-radius:10px}
.result-main{font-size:22px;font-weight:bold;margin-bottom:8px}
.result-sub{font-size:14px;opacity:.9;margin-top:4px}
.result-breakdown{margin-top:10px;padding:10px;background:rgba(255,255,255,.12);border-radius:8px;font-size:14px}
.limit-highlight{color:#1fa2ff;font-weight:bold}
.footer{margin-top:14px;font-size:12px;opacity:.8;text-align:center}
.disabled{opacity:0.4;pointer-events:none}
.helper{font-size:12px;opacity:.75;margin-top:4px}
.fade{transition:opacity .25s ease,max-height .25s ease}
</style>
</head>
<body>

<h1>Max FDP Calculator</h1>

<div class="card">
<form id="fdpForm">
  <div class="toggle">
    <input type="checkbox" id="reserveToggle">
    <label class="toggle-label" for="reserveToggle">
      <span class="left">Bid</span>
      <span class="right">Reserve</span>
      <div class="toggle-knob"></div>
    </label>
  </div>

  <label id="timeLabel">Report Time</label>
  <input type="time" id="reportTime" required>

  <label>Number of Pilots</label>
  <select id="pilots">
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
  </select>

  <div id="segmentsWrapper" class="fade">
    <label>Flight Segments</label>
    <div class="helper">Used only for un‑augmented (2‑pilot) crews</div>
    <select id="segments">
      <option>1</option><option>2</option><option>3</option>
      <option>4</option><option>5</option>
      <option>6</option><option>7</option>
    </select>
  </div>

  <div id="restWrapper" class="fade hidden">
    <label>Crew Rest Class</label>
    <div class="helper">Used only for augmented (3–4 pilot) crews</div>
    <select id="restClass">
      <option value="1">Class 1</option>
      <option value="2">Class 2</option>
      <option value="3">Class 3</option>
    </select>
  </div>

  <button type="submit">Calculate</button>
</form>

<div id="result" class="result"></div>
<div id="breakdown" class="result-breakdown hidden"></div>
<div class="footer">FAA References: 14 CFR §117.13, §117.17 — Tables B & C</div>
</div>

<script>
function timeToMinutes(t){const[a,b]=t.split(':').map(Number);return a*60+b}
function minutesToTimeAMPM(m){const h=Math.floor(m/60)%24, min=m%60;const ampm=h>=12?'PM':'AM';const hh=h%12||12;return `${hh}:${String(min).padStart(2,'0')} ${ampm}`}

const tableB=[[0,239,[9,9,9,9,9,9,9]],[240,299,[10,10,10,10,9,9,9]],[300,359,[12,12,12,12,11.5,11,10.5]],[360,419,[13,13,12,12,11.5,11,10.5]],[420,719,[14,14,13,13,12.5,12,11.5]],[720,779,[13,13,13,13,12.5,12,11.5]],[780,1019,[12,12,12,12,11.5,11,10.5]],[1020,1319,[12,12,11,11,10,9,9]],[1320,1379,[11,11,10,10,9,9,9]],[1380,1439,[10,10,10,9,9,9,9]]];
const tableC=[[0,359,{1:{3:15,4:17},2:{3:14,4:15.5},3:{3:13,4:13.5}}],[360,419,{1:{3:16,4:18.5},2:{3:15,4:16.5},3:{3:14,4:14.5}}],[420,779,{1:{3:17,4:19},2:{3:16.5,4:18},3:{3:15,4:15.5}}],[780,1019,{1:{3:16,4:18.5},2:{3:15,4:16.5},3:{3:14,4:14.5}}],[1020,1439,{1:{3:15,4:17},2:{3:14,4:15.5},3:{3:13,4:13.5}}]]

const pilotsSel=document.getElementById('pilots');
const segmentsWrap=document.getElementById('segmentsWrapper');
const restWrap=document.getElementById('restWrapper');
const reserveToggle=document.getElementById('reserveToggle');
const timeLabel=document.getElementById('timeLabel');
const breakdownDiv=document.getElementById('breakdown');

function updateInputStates(){
  const isTwo=pilotsSel.value==='2';
  restWrap.classList.toggle('disabled',isTwo);
  restWrap.querySelector('select').disabled=isTwo;
  segmentsWrap.classList.toggle('disabled',!isTwo);
  segmentsWrap.querySelector('select').disabled=!isTwo;
  restWrap.style.opacity=isTwo?0.4:1;
  segmentsWrap.style.opacity=!isTwo?0.4:1;
}
pilotsSel.addEventListener('change',updateInputStates);
updateInputStates();

reserveToggle.addEventListener('change',()=>{timeLabel.textContent=reserveToggle.checked?'RAP Start Time':'Report Time'});

document.getElementById('fdpForm').addEventListener('submit',e=>{
 e.preventDefault();
 const reportTime=document.getElementById('reportTime').value;
 const m=timeToMinutes(reportTime);
 const p=Number(pilotsSel.value);
 const segs=Number(document.getElementById('segments').value);
 const isReserve=reserveToggle.checked;
 let baseFDP=0;
 let combinedLimit=null;
 let limitSource='';

 if(p===2){
   const r=tableB.find(x=>m>=x[0]&&m<=x[1]);
   baseFDP=r?r[2][segs-1]:0;
   if(isReserve){
     const tableBPlus4=baseFDP+4;
     combinedLimit=Math.min(16,tableBPlus4);
     limitSource=(combinedLimit===16)?'<span class="limit-highlight">RAP+16</span>':'<span class="limit-highlight">Table B +4</span>';
   } else {
     combinedLimit=baseFDP;
     limitSource='<span class="limit-highlight">Table B</span>';
   }
 } else {
   const rest=Number(document.getElementById('restClass').value);
   const r=tableC.find(x=>m>=x[0]&&m<=x[1]);
   baseFDP=r?r[2][rest][p]:0;
   if(isReserve){
     combinedLimit=baseFDP+4;
     limitSource='<span class="limit-highlight">Table C +4</span>';
   } else {
     combinedLimit=baseFDP;
     limitSource='<span class="limit-highlight">Table C</span>';
   }
 }

// calculate end time in AM/PM
const startM=timeToMinutes(reportTime);
const endM=startM+combinedLimit*60;
const endTime=minutesToTimeAMPM(endM);

let preface=isReserve?'RAP+FDP Limit:':'FDP Limit:';

document.getElementById('result').innerHTML=`<div class='result-main'>${preface} ${combinedLimit} hrs (${limitSource})<br>End Time: ${endTime}</div><div class='result-sub'>Base Max FDP: ${baseFDP} hrs</div>`;

if(isReserve){
   breakdownDiv.classList.remove('hidden');
   breakdownDiv.innerHTML=p===2
     ? `<strong>Reserve Breakdown:</strong><br>Table B +4: ${baseFDP+4} hrs<br>RAP+16: 16 hrs<br>FDP Start + Table B: ${baseFDP} hrs`
     : `<strong>Reserve Breakdown:</strong><br>Combined RAP/FDP Limit: ${baseFDP+4} hrs`;
 } else breakdownDiv.classList.add('hidden');
});
</script>

</body>
</html>
