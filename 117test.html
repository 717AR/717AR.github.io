<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FAR 117 FDP Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#0e1a2b;
  color:#f5f5f5;
  padding:16px;
}
.card {
  background:#11243b;
  padding:16px;
  max-width:520px;
  margin:auto;
  border-radius:12px;
}
label {
  margin-top:10px;
  display:block;
  font-weight:bold;
}
input, select {
  width:100%;
  padding:8px;
  border-radius:6px;
  border:1px solid #4a90e2;
  background:#1a2a44;
  color:white;
}
button {
  margin-top:16px;
  width:100%;
  padding:10px;
  font-size:16px;
  background:#1fa2ff;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.hidden { display:none; }

.result {
  margin-top:16px;
  background:rgba(255,255,255,0.07);
  padding:14px;
  border-radius:10px;
}
.result-main {
  font-size:22px;
  font-weight:bold;
}
.highlight {
  margin-top:10px;
  padding:10px;
  border-left:4px solid #1fa2ff;
  background:rgba(31,162,255,0.15);
}
</style>
</head>

<body>

<div class="card">
<h2 style="text-align:center;">Max FDP Calculator</h2>

<form id="form">

<label>
  Mode
  <select id="mode">
    <option value="bid">Bid / LCR</option>
    <option value="scr">SCR</option>
  </select>
</label>

<label id="rapLabel">Report Time</label>
<input type="time" id="rapTime" required>

<div id="fdpBlock" class="hidden">
  <label>Report Time (FDP)</label>
  <input type="time" id="fdpTime">
</div>

<label>Flight Segments</label>
<select id="segments">
  <option>1</option><option>2</option><option>3</option>
  <option>4</option><option>5</option><option>6</option><option>7</option>
</select>

<label>Number of Pilots</label>
<select id="pilots">
  <option value="2">2 (Unaugmented)</option>
  <option value="3">3 (Augmented)</option>
  <option value="4">4 (Augmented)</option>
</select>

<button type="submit">Calculate</button>
</form>

<div id="output" class="result hidden"></div>
</div>

<script>
const form = document.getElementById('form');
const mode = document.getElementById('mode');
const rapLabel = document.getElementById('rapLabel');
const rapTime = document.getElementById('rapTime');
const fdpBlock = document.getElementById('fdpBlock');
const fdpTime = document.getElementById('fdpTime');
const segments = document.getElementById('segments');
const pilots = document.getElementById('pilots');
const output = document.getElementById('output');

mode.addEventListener('change', ()=>{
  const isSCR = mode.value === 'scr';
  rapLabel.textContent = isSCR ? 'RAP Start Time' : 'Report Time';
  fdpBlock.classList.toggle('hidden', !isSCR);
});

function toMin(t){
  const [h,m]=t.split(':').map(Number);
  return h*60+m;
}
function toTime(m){
  m%=1440;
  return `${String(Math.floor(m/60)).padStart(2,'0')}:${String(m%60).padStart(2,'0')}`;
}

/* TABLE B */
const tableB = [
  [9,9,9,9,9,9,9],
  [10,10,10,10,9,9,9],
  [12,12,12,12,11.5,11,10.5],
  [13,13,12,12,11.5,11,10.5],
  [14,14,13,13,12.5,12,11.5],
  [13,13,13,13,12.5,12,11.5],
  [12,12,12,12,11.5,11,10.5],
  [12,12,11,11,10,9,9],
  [11,11,10,10,9,9,9],
  [10,10,10,9,9,9,9]
];
const tableBRanges=[0,240,300,360,420,720,780,1020,1320,1380];

function tableBlookup(start,segs){
  let idx=tableBRanges.findIndex((v,i)=>start>=v && start<(tableBRanges[i+1]||1440));
  return tableB[idx][segs-1];
}

/* TABLE C (117.17) */
const tableC = {
  3:[
    [13,13,13,13,13,13,13],
    [14,14,14,14,13.5,13,13],
    [16,16,16,16,15.5,15,14.5],
    [17,17,16,16,15.5,15,14.5],
    [18,18,17,17,16.5,16,15.5],
    [17,17,17,17,16.5,16,15.5],
    [16,16,16,16,15.5,15,14.5],
    [16,16,15,15,14,13,13],
    [15,15,14,14,13,13,13],
    [14,14,14,13,13,13,13]
  ],
  4:[
    [15,15,15,15,15,15,15],
    [16,16,16,16,15.5,15,15],
    [18,18,18,18,17.5,17,16.5],
    [19,19,18,18,17.5,17,16.5],
    [20,20,19,19,18.5,18,17.5],
    [19,19,19,19,18.5,18,17.5],
    [18,18,18,18,17.5,17,16.5],
    [18,18,17,17,16,15,15],
    [17,17,16,16,15,15,15],
    [16,16,16,15,15,15,15]
  ]
};

function tableClookup(start,segs,p){
  let idx=tableBRanges.findIndex((v,i)=>start>=v && start<(tableBRanges[i+1]||1440));
  return tableC[p][idx][segs-1];
}

form.addEventListener('submit',e=>{
  e.preventDefault();
  const seg=+segments.value;
  const p=+pilots.value;
  const rap=toMin(rapTime.value);

  let html='';

  if(mode.value==='bid'){
    const tb=tableBlookup(rap,seg);
    const end=rap+tb*60;
    html=`
      <div class="result-main">Max FDP Ends: ${toTime(end)}</div>
      <div>Total FDP: ${tb} hrs</div>
      <div class="highlight">Table B applied</div>`;
  }

  if(mode.value==='scr'){
    const fdp=toMin(fdpTime.value);

    if(p===2){
      const tb=tableBlookup(fdp,seg);
      const limits=[
        {n:'RAP + 16',v:rap+960},
        {n:'FDP + Table B',v:fdp+tb*60},
        {n:'RAP + Table B + 4',v:rap+tb*60+240}
      ].sort((a,b)=>a.v-b.v);

      html=`
        <div class="result-main">Max FDP Ends: ${toTime(limits[0].v)}</div>
        <div>Total FDP: ${((limits[0].v-fdp)/60).toFixed(1)} hrs</div>
        <div class="highlight">Controlling: ${limits[0].n}</div>`;
    } else {
      const tc=tableClookup(fdp,seg,p);
      const end=fdp+tc*60;
      html=`
        <div class="result-main">Max FDP Ends: ${toTime(end)}</div>
        <div>Total FDP: ${tc} hrs</div>
        <div class="highlight">Table C (${p} pilots) applied</div>`;
    }
  }

  output.innerHTML=html;
  output.classList.remove('hidden');
});
</script>

</body>
</html>
